---
page_title: "shell_script (Data Source) - terraform-provider-shell"
subcategory: ""
description: |-
  The Shell script data source (shell_script) allows you to execute an arbitrary command as the read part of a Terraform lifecycle. The script must output a JSON string to the file defined by the TF_SCRIPT_OUTPUT environment variable and the file must be consistent on re-reading. If the script exits with a non-zero code the provider will ready any text from the file defined by the TF_SCRIPT_ERROR environment variable and return it as part of the error diagnostics.
---

# shell_script (Data Source)

The _Shell_ script data source (`shell_script`) allows you to execute an arbitrary command as the read part of a _Terraform_ lifecycle. The script must output a JSON string to the file defined by the `TF_SCRIPT_OUTPUT` environment variable and the file must be consistent on re-reading. If the script exits with a non-zero code the provider will ready any text from the file defined by the `TF_SCRIPT_ERROR` environment variable and return it as part of the error diagnostics.

## Environment Variables

The following environment variables provide the shell script integration with the provider.

| **Name** | **Description** |
| :--- | :--- |
| `TF_SCRIPT_LIFECYCLE` | The current lifecycle that triggered the script; this will always be `read`. |
| `TF_SCRIPT_INPUTS` | The values passed into the data source `inputs` as JSON. |
| `TF_SCRIPT_OUTPUT` | Path to the file where the script output must be written; the output must be valid JSON. |
| `TF_SCRIPT_ERROR` | Path to a file which will be read as the error diagnostics if the scripts exits with a non-zero code. |

## Example Usage

```terraform
data "shell_script" "example" {
  inputs = {
    version_count = 3
  }
  os_commands = {
    default = {
      read = {
        command = <<-EOF
          set -euo pipefail
          version_count="$(jq --raw-output '.version_count' <<<"$${TF_SCRIPT_INPUTS}")"
          curl --fail --silent --location --retry 3 https://endoflife.date/api/terraform.json | jq --raw-output --compact-output --argjson count "$${version_count}" '[sort_by(.releaseDate) | reverse | .[0:$count] | .[].latest]' > "$${TF_SCRIPT_OUTPUT}"
        EOF
      }
    }
    windows = {
      read = {
        command = <<-EOF
          $inputs = $env:TF_SCRIPT_INPUTS | ConvertFrom-Json
          $response = Invoke-RestMethod -Uri "https://endoflife.date/api/terraform.json"
          $sorted = $response | Sort-Object releaseDate -Descending | Select-Object -First $inputs.version_count
          $latest = $sorted | ForEach-Object { $_.latest }
          $latest | ConvertTo-Json -Compress | Out-File -FilePath $env:TF_SCRIPT_OUTPUT -Encoding utf8
        EOF
      }
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `os_commands` (Attributes Map) A map of commands to run as part of the Terraform lifecycle where the map key is the `GOOS` value or `default`; `default` must be provided. (see [below for nested schema](#nestedatt--os_commands))

### Optional

- `environment` (Map of String) The environment variables to set when executing command; to be combined with the OS environment and the provider environment.
- `inputs` (Dynamic) Inputs to be made available to the script; these can be accessed as JSON via the `TF_SCRIPT_INPUTS` environment variable.
- `timeouts` (Attributes) (see [below for nested schema](#nestedatt--timeouts))
- `working_directory` (String) The working directory to use when executing the command; this will default to the _Terraform_ working directory.

### Read-Only

- `output` (Dynamic) The output of the script as a structured type.

<a id="nestedatt--os_commands"></a>
### Nested Schema for `os_commands`

Required:

- `read` (Attributes) The read command configuration. (see [below for nested schema](#nestedatt--os_commands--read))

<a id="nestedatt--os_commands--read"></a>
### Nested Schema for `os_commands.read`

Required:

- `command` (String) The read command to execute.

Optional:

- `interpreter` (List of String) The interpreter to use for executing the read command; if not set the platform default interpreter will be used.



<a id="nestedatt--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `read` (String) Timeout for reading the data source; this defaults to the provider value if not set. This should be a string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as `30s` or `2h45m`. Valid time units are `s` (seconds), `m` (minutes), `h` (hours).
